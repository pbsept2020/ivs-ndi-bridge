<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projecteur IVS</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            width: 100%;
            height: 100%;
            background: #000;
            overflow: hidden;
            cursor: none;
        }
        body:hover { cursor: default; }
        body.idle { cursor: none; }
        
        #videoContainer {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #projectorImage {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
        }
        
        #info {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 10px 16px;
            border-radius: 8px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 13px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 100;
        }
        body:hover #info { opacity: 1; }
        
        #info .name { font-weight: 600; color: #00d4aa; }
        #info .hint { margin-top: 6px; font-size: 11px; color: #888; }
        
        #waiting {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #666;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        #waiting .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #333;
            border-top-color: #00d4aa;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        #waiting.hidden { display: none; }
    </style>
</head>
<body>
    <div id="videoContainer">
        <img id="projectorImage" alt="Flux vidéo">
    </div>
    
    <div id="waiting">
        <div class="spinner"></div>
        <div>En attente du flux vidéo...</div>
    </div>
    
    <div id="info">
        <div class="name" id="displayName">Source IVS</div>
        <div class="hint">Appuyez sur <kbd>Échap</kbd> pour fermer</div>
    </div>

    <script>
        // Récupérer les paramètres de l'URL
        const params = new URLSearchParams(window.location.search);
        const participantId = params.get('participantId');
        const displayName = params.get('displayName') || 'Source IVS';
        
        document.getElementById('displayName').textContent = displayName;
        document.title = `Projecteur - ${displayName}`;
        
        const image = document.getElementById('projectorImage');
        const waiting = document.getElementById('waiting');
        let frameCount = 0;
        let idleTimeout = null;
        
        // Masquer le curseur après inactivité
        function resetIdleTimer() {
            document.body.classList.remove('idle');
            clearTimeout(idleTimeout);
            idleTimeout = setTimeout(() => {
                document.body.classList.add('idle');
            }, 2000);
        }
        
        document.addEventListener('mousemove', resetIdleTimer);
        resetIdleTimer();
        
        // Réception des frames
        if (window.bridge && window.bridge.projector) {
            window.bridge.projector.onFrame(({ frameDataUrl }) => {
                if (frameDataUrl) {
                    image.src = frameDataUrl;
                    frameCount++;
                    
                    if (frameCount === 1) {
                        waiting.classList.add('hidden');
                        console.log('[Projector] First frame received');
                    }
                }
            });
            console.log('[Projector] Ready, waiting for frames...');
        } else {
            console.error('[Projector] Bridge not available');
            waiting.innerHTML = '<div style="color: #f44;">Erreur: Bridge non disponible</div>';
        }
        
        // Raccourci clavier Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                window.close();
            }
        });
    </script>
</body>
</html>
